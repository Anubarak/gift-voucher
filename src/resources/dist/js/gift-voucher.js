!function(c){void 0===Craft.GiftVoucher&&(Craft.GiftVoucher={});var n="verbb\\giftvoucher\\elements\\Voucher";Craft.GiftVoucher.VoucherIndex=Craft.BaseElementIndex.extend({editableVoucherTypes:null,$newVoucherBtnVoucherType:null,$newVoucherBtn:null,init:function(e,t,i){this.on("selectSource",c.proxy(this,"updateButton")),this.on("selectSite",c.proxy(this,"updateButton")),this.base(e,t,i)},afterInit:function(){this.editableVoucherTypes=[];for(var e=0;e<Craft.GiftVoucher.editableVoucherTypes.length;e++){var t=Craft.GiftVoucher.editableVoucherTypes[e];this.getSourceByKey("voucherType:"+t.id)&&this.editableVoucherTypes.push(t)}this.base()},getDefaultSourceKey:function(){if("index"===this.settings.context&&"undefined"!=typeof defaultVoucherTypeHandle)for(var e=0;e<this.$sources.length;e++){var t=c(this.$sources[e]);if(t.data("handle")===defaultVoucherTypeHandle)return t.data("key")}return this.base()},updateButton:function(){if(this.$source){var e=this.$source.data("handle");if(this.editableVoucherTypes.length){var t,i;if(this.$newVoucherBtnVoucherType&&this.$newVoucherBtnVoucherType.remove(),e)for(h=0;h<this.editableVoucherTypes.length;h++)if(this.editableVoucherTypes[h].handle===e){t=this.editableVoucherTypes[h];break}if(this.$newVoucherBtnGroup=c('<div class="btngroup submit"/>'),t){var r=this._getVoucherTypeTriggerHref(t),n="index"===this.settings.context?Craft.t("gift-voucher","New voucher"):Craft.t("gift-voucher","New {voucherType} voucher",{voucherType:t.name});this.$newVoucherBtn=c('<a class="btn submit add icon" '+r+">"+n+"</a>").appendTo(this.$newVoucherBtnGroup),"index"!==this.settings.context&&this.addListener(this.$newVoucherBtn,"click",function(e){this._openCreateVoucherModal(e.currentTarget.getAttribute("data-id"))}),1<this.editableVoucherTypes.length&&(i=c('<div class="btn submit menubtn"></div>').appendTo(this.$newVoucherBtnGroup))}else this.$newVoucherBtn=i=c('<div class="btn submit add icon menubtn">'+Craft.t("gift-voucher","New voucher")+"</div>").appendTo(this.$newVoucherBtnGroup);if(i){for(var o='<div class="menu"><ul>',h=0;h<this.editableVoucherTypes.length;h++){var s=this.editableVoucherTypes[h],r,n;if("index"===this.settings.context||s!==t)o+="<li><a "+(r=this._getVoucherTypeTriggerHref(s))+'">'+(n="index"===this.settings.context?s.name:Craft.t("gift-voucher","New {voucherType} voucher",{voucherType:s.name}))+"</a></li>"}c(o+="</ul></div>").appendTo(this.$newVoucherBtnGroup);var u=new Garnish.MenuBtn(i);"index"!==this.settings.context&&u.on("optionSelect",c.proxy(function(e){this._openCreateVoucherModal(e.option.getAttribute("data-id"))},this))}this.addButton(this.$newVoucherBtnGroup)}if("index"===this.settings.context&&"undefined"!=typeof history){var a="gift-voucher/vouchers";e&&(a+="/"+e),history.replaceState({},"",Craft.getUrl(a))}}},_getVoucherTypeTriggerHref:function(e){if("index"!==this.settings.context)return'data-id="'+e.id+'"';var t="gift-voucher/vouchers/"+e.handle+"/new";if(this.siteId&&this.siteId!=Craft.primarySiteId)for(var i=0;i<Craft.sites.length;i++)Craft.sites[i].id==this.siteId&&(t+="/"+Craft.sites[i].handle);return'href="'+Craft.getUrl(t)+'"'},_openCreateVoucherModal:function(i){if(!this.$newVoucherBtn.hasClass("loading")){for(var e,t=0;t<this.editableVoucherTypes.length;t++)if(this.editableVoucherTypes[t].id===i){e=this.editableVoucherTypes[t];break}if(e){this.$newVoucherBtn.addClass("inactive");var r=this.$newVoucherBtn.text();this.$newVoucherBtn.text(Craft.t("gift-voucher","New {voucherType} voucher",{voucherType:e.name})),new Craft.ElementEditor({hudTrigger:this.$newVoucherBtnGroup,elementType:n,siteId:this.siteId,attributes:{typeId:i},onBeginLoading:c.proxy(function(){this.$newVoucherBtn.addClass("loading")},this),onEndLoading:c.proxy(function(){this.$newVoucherBtn.removeClass("loading")},this),onHideHud:c.proxy(function(){this.$newVoucherBtn.removeClass("inactive").text(r)},this),onSaveElement:c.proxy(function(e){var t="voucherType:"+i;this.sourceKey!==t&&this.selectSourceByKey(t),this.selectElementAfterUpdate(e.id),this.updateElements()},this)})}}}}),Craft.registerElementIndexClass(n,Craft.GiftVoucher.VoucherIndex)}(jQuery),function(i){void 0===Craft.GiftVoucher&&(Craft.GiftVoucher={});var e="verbb\\giftvoucher\\elements\\Code";Craft.GiftVoucher.CodeIndex=Craft.BaseElementIndex.extend({afterInit:function(){var e='href="'+Craft.getUrl("gift-voucher/codes/new")+'"',t=Craft.t("gift-voucher","New code");this.$newProductBtnGroup=i('<div class="btngroup submit"/>'),this.$newProductBtn=i('<a class="btn submit add icon" '+e+">"+t+"</a>").appendTo(this.$newProductBtnGroup),this.addButton(this.$newProductBtnGroup),this.base()}});try{Craft.registerElementIndexClass(e,Craft.GiftVoucher.CodeIndex)}catch(e){}}(jQuery),void 0===Craft.GiftVoucher&&(Craft.GiftVoucher={}),jQuery;
//# sourceMappingURL=gift-voucher.js.map
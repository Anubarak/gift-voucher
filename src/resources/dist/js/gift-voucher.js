!function(c){void 0===Craft.GiftVoucher&&(Craft.GiftVoucher={});var n="verbb\\giftvoucher\\elements\\Voucher";Craft.GiftVoucher.VoucherIndex=Craft.BaseElementIndex.extend({editableVoucherTypes:null,$newVoucherBtnVoucherType:null,$newVoucherBtn:null,init:function(e,t,r){this.on("selectSource",c.proxy(this,"updateButton")),this.on("selectSite",c.proxy(this,"updateButton")),this.base(e,t,r)},afterInit:function(){this.editableVoucherTypes=[];for(var e=0;e<Craft.GiftVoucher.editableVoucherTypes.length;e++){var t=Craft.GiftVoucher.editableVoucherTypes[e];this.getSourceByKey("voucherType:"+t.id)&&this.editableVoucherTypes.push(t)}this.base()},getDefaultSourceKey:function(){if("index"===this.settings.context&&"undefined"!=typeof defaultVoucherTypeHandle)for(var e=0;e<this.$sources.length;e++){var t=c(this.$sources[e]);if(t.data("handle")===defaultVoucherTypeHandle)return t.data("key")}return this.base()},updateButton:function(){if(this.$source){var e=this.$source.data("handle"),t,r,i;if(this.editableVoucherTypes.length){var n,o;if(this.$newVoucherBtnVoucherType&&this.$newVoucherBtnVoucherType.remove(),e)for(t=0;t<this.editableVoucherTypes.length;t++)if(this.editableVoucherTypes[t].handle===e){n=this.editableVoucherTypes[t];break}if(this.$newVoucherBtnVoucherType=c('<div class="btngroup submit"/>'),n?(r=this._getVoucherTypeTriggerHref(n),i="index"===this.settings.context?Craft.t("gift-voucher","New voucher"):Craft.t("gift-voucher","New {voucherType} voucher",{voucherType:n.name}),this.$newVoucherBtn=c('<a class="btn submit add icon" '+r+">"+Craft.escapeHtml(i)+"</a>").appendTo(this.$newVoucherBtnVoucherType),"index"!==this.settings.context&&this.addListener(this.$newVoucherBtn,"click",function(e){this._openCreateVoucherModal(e.currentTarget.getAttribute("data-id"))}),1<this.editableVoucherTypes.length&&(o=c('<div class="btn submit menubtn"></div>').appendTo(this.$newVoucherBtnVoucherType))):this.$newVoucherBtn=o=c('<div class="btn submit add icon menubtn">'+Craft.t("gift-voucher","New voucher")+"</div>").appendTo(this.$newVoucherBtnVoucherType),o){for(var h='<div class="menu"><ul>',t=0;t<this.editableVoucherTypes.length;t++){var s=this.editableVoucherTypes[t];"index"!==this.settings.context&&s===n||(r=this._getVoucherTypeTriggerHref(s),i="index"===this.settings.context?s.name:Craft.t("gift-voucher","New {voucherType} voucher",{voucherType:s.name}),h+="<li><a "+r+'">'+Craft.escapeHtml(i)+"</a></li>")}c(h+="</ul></div>").appendTo(this.$newVoucherBtnVoucherType);var u=new Garnish.MenuBtn(o);"index"!==this.settings.context&&u.on("optionSelect",c.proxy(function(e){this._openCreateVoucherModal(e.option.getAttribute("data-id"))},this))}this.addButton(this.$newVoucherBtnVoucherType)}if("index"===this.settings.context&&"undefined"!=typeof history){var a="gift-voucher/vouchers";e&&(a+="/"+e),history.replaceState({},"",Craft.getUrl(a))}}},_getVoucherTypeTriggerHref:function(e){if("index"!==this.settings.context)return'data-id="'+e.id+'"';var t="gift-voucher/vouchers/"+e.handle+"/new";if(this.siteId&&this.siteId!=Craft.primarySiteId)for(var r=0;r<Craft.sites.length;r++)Craft.sites[r].id==this.siteId&&(t+="/"+Craft.sites[r].handle);return'href="'+Craft.getUrl(t)+'"'},_openCreateVoucherModal:function(r){if(!this.$newVoucherBtn.hasClass("loading")){for(var e,t=0;t<this.editableVoucherTypes.length;t++)if(this.editableVoucherTypes[t].id===r){e=this.editableVoucherTypes[t];break}if(e){this.$newVoucherBtn.addClass("inactive");var i=this.$newVoucherBtn.text();this.$newVoucherBtn.text(Craft.t("gift-voucher","New {voucherType} voucher",{voucherType:e.name})),new Craft.ElementEditor({hudTrigger:this.$newVoucherBtnGroup,elementType:n,siteId:this.siteId,attributes:{typeId:r},onBeginLoading:c.proxy(function(){this.$newVoucherBtn.addClass("loading")},this),onEndLoading:c.proxy(function(){this.$newVoucherBtn.removeClass("loading")},this),onHideHud:c.proxy(function(){this.$newVoucherBtn.removeClass("inactive").text(i)},this),onSaveElement:c.proxy(function(e){var t="voucherType:"+r;this.sourceKey!==t&&this.selectSourceByKey(t),this.selectElementAfterUpdate(e.id),this.updateElements()},this)})}}}}),Craft.registerElementIndexClass(n,Craft.GiftVoucher.VoucherIndex)}(jQuery),function(r){void 0===Craft.GiftVoucher&&(Craft.GiftVoucher={});var e="verbb\\giftvoucher\\elements\\Code";Craft.GiftVoucher.CodeIndex=Craft.BaseElementIndex.extend({afterInit:function(){var e='href="'+Craft.getUrl("gift-voucher/codes/new")+'"',t=Craft.t("gift-voucher","New code");this.$newProductBtnGroup=r('<div class="btngroup submit"/>'),this.$newProductBtn=r('<a class="btn submit add icon" '+e+">"+t+"</a>").appendTo(this.$newProductBtnGroup),this.addButton(this.$newProductBtnGroup),this.base()}});try{Craft.registerElementIndexClass(e,Craft.GiftVoucher.CodeIndex)}catch(e){}}(jQuery),void 0===Craft.GiftVoucher&&(Craft.GiftVoucher={}),jQuery;
//# sourceMappingURL=gift-voucher.js.map